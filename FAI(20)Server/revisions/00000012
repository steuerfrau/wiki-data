Used tutorial from:

http://fai-project.org/fai-guide/#_a_id_setup_a_setup_your_faiserver

Create individual configurations using:
{{{#!highlight
fai-chboot -IFv -u nfs://faiserver/srv/fai/config demohost
}}}

The autogenerated files at /srv/tftp/fai/pxelinux.cfg did not work for me. NFS was not beeing mounted. Following configuration worked:
{{{#!highlight
# generated by fai-chboot for host mel01testpxe01 with IP 192.168.110.40
default fai-generated

label fai-generated
kernel vmlinuz-3.16.0-4-amd64
append initrd=initrd.img-3.16.0-4-amd64 ip=dhcp  root=/dev/nfs nfsroot=192.168.110.57:/srv/fai/nfsroot aufs  FAI_FLAGS=verbose,sshd,createvt FAI_CONFIG_SRC=nfs://192.168.110.57/srv/fai/config FAI_ACTION=install
}}}

= Custom Partitioning Scheme =
{{{#!highlight
cd /srv/fai/config/class
cp FAIBASE.var HOPPETOSSE_CLUSTER_TST.var
}}}

Define custom scheme in /srv/fai/config/class/50-host-classes
{{{#!highlight
case $HOSTNAME in
    mel01testpxe01)
        echo "HOPPETOSSE_CLUSTER_TST DEBIAN_HPT_PCM DHCP" ;;
    faiserver)
        echo "FAIBASE DEBIAN DHCPC DEMO FAISERVER" ;;
    demohost|client*)
        echo "FAIBASE DEBIAN DHCPC DEMO" ;;
    xfcehost)
        echo "FAIBASE DEBIAN DHCPC DEMO XORG XFCE";;
    gnomehost)
        echo "FAIBASE DEBIAN DHCPC DEMO XORG GNOME";;
    bear)
        echo "FAIBASE DEBIAN DHCPC LVM_XEN_SERVER XEN" ;;
    puma)
        echo "FAIBASE DEBIAN DHCPC RAID_XEN_VIRTUAL" ;;
    centos)
        echo "FAIBASE CENTOS"   # you may want to add class XORG here
        ifclass I386 && echo CENTOS6_32
}}}

Create partitioning scheme in /srv/fai/config/disk_config/HOPPETOSSE_CLUSTER_TST
{{{#!highlight
# example of new config file for setup-storage
#
# <type> <mountpoint> <size>   <fs type> <mount options> <misc options>

disk_config disk1 disklabel:msdos bootable:1 fstabkey:uuid

primary -        512           -    -
primary -        1500M-100%    -    -

disk_config disk2 disklabel:msdos bootable:1 fstabkey:uuid

primary -         512          -    -
primary -         1500M-100%   -    -


disk_config raid
raid0   -     sda2,sdb2 - -
raid1   /boot sda1,sdb1 ext4 rw,noatime

disk_config cryptsetup
luks:"secret" - md0 - -
# # createopts="âˆ’m 0"


disk_config lvm
vg Hoppetosse md0
Hoppetosse-Root /      1200M ext4 rw
Hoppetosse-Swap swap   512    swap sw 

}}}
= Add Cryptsetup to NFS Root =
On FAI server create /etc/fai/nfsroot-hooks/40-cryptsetup with content:
{{{#!highlight
#!/bin/bash

chroot /srv/fai/nfsroot aptitude -y install cryptsetup 
chroot /srv/fai/nfsroot aptitude -y install cryptsetup-bin
}}}
And update NFS root filesystem with:
{{{#!highlight

sudo fai-make-nfsroot -k
}}}

= Manually Run Partitioning on Client =
{{{#!highlight
setup-storage -X -f /var/lib/fai/config/disk_config/<NAME>
}}}

= German Keymaps =
     Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]

Hi!

We had a similar problem with locales and console-data / console-common and
the problem seems to be that if locales are installed via apt-get or
aptitude
the default locale is set to none and all debconf settings are overwritten.
Also /etc/default/locale is empty afterwards (Quite a strange imho)

Our solution was to add the script 60-reconfigure in scripts to LAST:

----
if ifclass 'GERMAN'
then
    echo "locales locales/default_environment_locale select de_DE.UTF-8" |
\
        $ROOTCMD debconf-set-selection -v
    $ROOTCMD update-locale LANG=de_DE.UTF-8
fi

$ROOTCMD dpkg-reconfigure -f noninteractive locales

Regards,
----
Kai

= Password Problems Workaround =
On host, after installation succeeded execute:
{{{#!highlight
chroot /target passwd
chroot /target adduser melly
chroot /target usermod -a -G sudo melly
}}}
