Create
/srv/fai/config/files/etc/network/interfaces-template-ovs-vlan-trunk/DEBIAN_OVS_VLAN_TRUNK

{{{#!highlight
#c This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# openvswitch-switch.README.Debian
# auto br0
allow-ovs br0
iface br0 inet manual
    ovs_type OVSBridge
    ovs_ports eth0 vlan1 vlan110 vlan120

# For DRBD / Corosync
auto eth1
iface eth0 inet static
  address 192.192.130.30
  netmask 255.255.255.0


auto eth2
iface eth0 inet static
  address 192.168.140.30
  netmask 255.255.255.0


# https://pve.proxmox.com/wiki/Open_vSwitch
# auto eth0
allow-br0 eth0
iface eth0 inet manual
  ovs_bridge br0
  ovs_type OVSPort
  ovs_options tag=1 vlan_mode=native-untagged
  # mel ovs_options vlan_mode=trunk trunks=0,1,110,120


# https://pve.proxmox.com/wiki/Open_vSwitch
allow-br0 vlan1
iface vlan1 inet static
  ovs_type OVSIntPort
  ovs_bridge br0
  ovs_options tag=1
  ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)-${IFACE}-vif
  address 10.90.90.30
  netmask 255.255.255.0

allow-br0 vlan110
iface vlan110 inet static
  ovs_type OVSIntPort
  ovs_bridge br0
  ovs_options tag=110
  ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)-${IFACE}-vif
  address 192.168.110.30
  netmask 255.255.255.0
  gateway 192.168.110.1

allow-br0 vlan120
iface vlan120 inet static
  ovs_type OVSIntPort
  ovs_bridge br0
  ovs_options tag=120
  ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)-${IFACE}-vif
  address 192.168.120.30
  netmask 255.255.255.0
  gateway 192.168.120.1

}}}

Activate fcopy for /etc/network/interfaces-template-*
/srv/fai/config/scripts/DEBIAN/30-interface

{{{#!highlight
#! /bin/bash

error=0; trap 'error=$(($?>$error?$?:$error))' ERR # save maximum error code

if ifclass DHCPC && [ $FAI_ACTION = "install" ]
then
    cat > $target/etc/network/interfaces <<-EOF
        # generated by FAI
        auto lo $NIC1
        iface lo inet loopback
        iface $NIC1 inet dhcp
EOF
elif [ $FAI_ACTION = "install" ]
then
      [ -n "$IPADDR" ] && cat > $target/etc/network/interfaces <<-EOF
        # generated by FAI
        auto lo $NIC1
        iface lo inet loopback
        iface $NIC1 inet static
          address $IPADDR
          netmask $NETMASK
          broadcast $BROADCAST
          gateway $GATEWAYS
EOF
    [ -n "$NETWORK" ] && echo "localnet $NETWORK" > $target/etc/networks
    [ -L $target/etc/resolv.conf ] || cp -p /etc/resolv.conf $target/etc
fi

# here fcopy is mostly used, when installing a client for running in a
# different subnet than during the installation
fcopy -iM /etc/resolv.conf
fcopy -iM /etc/network/interfaces /etc/networks
fcopy -iM /etc/network/interfaces-template-*

exit $error

}}}

Add class to host:
/srv/fai/config/class/50-host-classes

{{{#!highlight
case $HOSTNAME in
    mel01testpxe01)
        echo "FAIBASE DEBIAN DHCP GERMAN SALT-MINION HOPPETOSSE_CLUSTER_KVM CRYPT_BOOT MEL_PKGS" ;;
        # echo "HOPPETOSSE_CLUSTER_TST DEBIAN_HPT_PCM DHCP" ;;
    juno)
        echo "FAIBASE DEBIAN DHCP GERMAN SALT-MINION DEBIAN_OVS_VLAN_TRUNK HOPPETOSSE_CLUSTER_METAL CRYPT_BOOT MEL_PKGS" ;;

}}}

After installation of the host a prepared configuration for ovs vlan trunk can be found at

/etc/network/interface.ovs-vlan-trunk
